{"type":"Network","subjects":["dochub.front","dochub.front.spa","dochub.front.spa.blank","dochub.front.spa.blank.doc"],"source":"(\n  $manifest := $;\n  /* Перебираем все компоненты */\n  $adges  := $distinct(components.$spread().(\n    $node_id := $keys()[0];\n    $node := $.*;\n    /* Определяем связи */\n    $node.links.{\n      \"from\": $node_id,\n      \"to\": id,\n      \"label\": title\n    }\n  ));\n  /* Выявляем ноды из связей */\n  $nodes := $distinct($append($adges.from, $adges.to)).(\n    $struct := $split($, \".\");\n    $group := $replace($, \".\" & $reverse($struct)[0], \"\");\n    {\n      \"id\": $,\n      \"label\": $lookup($manifest.components, $).title,\n      \"group\": $group,\n      \"level\": $count($struct),\n      /* Позиционируем ноду тем выше, чем выше слой */\n      \"y\": $count($struct) * 200\n    }\n  );\n  /* Добавляем ноды легенды */\n  $nodes := $append($nodes, (\n    /* Получаем максимальную точку позиции нод */\n    $height := $max($nodes.y);\n    $groups := $distinct($nodes.group)^($);\n    /* Вычисляем центр легенды */\n    $offset := -($height / 2);\n    /* Определяем шаг легенды */\n    $step := $height / $count($groups);\n    /* Строим легенду */\n    $map($groups, function($v, $i, $a) {\n      {\n        \"id\": \"legend-\" & $string($i),\n        \"x\": -600,\n        \"y\": $i * $step + $offset,\n        \"shape\": \"square\",\n        \"label\": $v,\n        \"group\": $v,\n        \"value\": 1,\n        \"fixed\": true,\n        \"physics\": false\n      }\n    })\n  ));\n  /* Выводим результат */\n  {\n    \"nodes\": $nodes, /* Массив нод */\n    \"edges\": $adges, /* Массив связей */\n    \"options\": {     /* Параметры сетевой диаграммы https://visjs.github.io/vis-network/docs/network/ */\n      \"clickToUse\": false /* Отключаем обязательный клик перед взаимодействем с пользователем */\n    }\n  }\n)\n"}