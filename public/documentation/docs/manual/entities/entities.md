# Сущности(entities)

Метамодель DocHub можно расширять. Это позволяют делать кастомные сущности.

Предположим, что мы хотим описывать сценарии взаимодействия некоторых объектов. 
Для этого декларируем новую сущность - "interactions".

## Декларирование новой сущности

```yaml
entities:           # Здесь описываются кастомные сущности
  interactions:     # Идентификатор новой сущности. Обязательно.
    # Название сущности. Обязательно.
    title: Взаимодействия   
    # Описание сущности текст или ссылка на документ. Необязательно.
    description: >          
        Взаимодействия между компонентами
```

Данная запись сообщила DocHub, что в метамодели появилась новая сущность "interactions". 

Теперь, можно попробовать описать объект данной сущности.

```yaml
# Идентификатор сущности
interactions:
  # Идентификатор объекта
  dochub.user:
    title: Взаимодействия с пользователем
    triggers:
      - Просмотр архитектуры
    steps:
      - from: User
        to: DocHub
        value: Вход на портал
      - from: DocHub
        to: User
        value: Представление архитектурных артефактов
    results:
      - Информация о существующей архитектуре
```

В секции "interactions" находится произвольная структура. Ее образ и смысл полностью определяется задумкой автора.
DocHub, на этом этапе, ничего о ней не знает и делать не умеет.


## Схема данных объектов сущностей

Для того, чтобы DocHub мог контролировать структуру данных в секции "interactions", необходимо описать схему данных 
в специальном разделе "schema" с использованием [JSONSchema](https://json-schema.org/):

```yaml
entities:
  interactions:
    title: Взаимодействия   
    description: >          
        Взаимодействия между компонентами
    schema:
      # Структура будет представлять из себя объект
      type: object 
      # Его поля должны соответствовать паттерну идентификатора состоящего из 
      # идентификаторов доменов разделенных точкой. Например: dochub.user
      patternProperties:
        "[a-zA-Z0-9_]*(\\.[a-zA-Z0-9_]*)*$": # Шаблон 
          type: array     # Внутри должен быть массив
          minItems: 1     # Минимум из одного элемента
          items:    
            type: object  # Массив должен быть наполнен объектами сценариев
            properties:   # со следующей структурой
              icon:       # Идентификатор иконки
                title: Иконка   # Описание поля, которое помогает понять его смысл и выдается в подсказках
                type: string    # Идентификатор может быть любой строкой
                minLength: 2    # Но ее длина не должна быть меньше двух символов
              title:       # Наименование сценария
                title: Наименование
                type: string
                minLength: 5
              triggers:   # Перечень причин вызывающий данный сценарий
                title: События запускающие взаимодействие
                type: array
                minItems: 1
                items:
                  type: string
                  minLength: 5
              steps:        # Шаги сценария
                title: Описание взаимодействия
                type: array
                minItems: 1 # Минимум один шаг
                items:
                  type: object
                  properties:
                    from:   # Откуда делается шаг
                      title: От кого
                      type: string
                      minLength: 1
                    to:     # Куда
                      title: Кому
                      type: string
                      minLength: 1
                    value:  # Что в нем происходит
                      title: Что
                      type: string
                      minLength: 1
                # Сообщаем, что перечисленные поля обязательны
                required:
                  - from
                  - to
                  - value
              results:      # Результаты данного взаимодействия
                title: Результаты взаимодействия
                type: array
                minItems: 1
                items:
                  type: string
                  minLength: 5
          # Сообщаем, что перечисленные поля обязательны
          required:
            - title
            - triggers
            - results
            - steps
```

Теперь, DocHub знает как должна быть описана структура в секции "interactions" и может досказывать при вводе,
а также сообщать об ошибках.






Пример описания сущности [взаимодействия](/entities/interactions/tree) ([полный исходный файл](/documentation/entities/interactions/entity.yaml)):
```yaml
entities: # Сущности расширенной матемодели
    # Взаимводействия
    interactions:               # Секция, где будет описываться объекты сущности "взаимодействие". Обязательно.
        # Название сущности. Обязательно.
        title: Взаимодействия   
        # Описание сущности текст или ссылка на документ. Необязательно.
        description: >          
            Взаимодействия между компонентами
        # Генератор раcположения в меню. Запрос или явное описание объета. Необязательно.
        menu: >                 
          (
            ... JSONata запрос ...
          )
        # Представления объектов сущности. Обязательно.
        presentations:          
            # Идентификатор представления. Дерево взаимодействий.
            tree:               
                # Тип представления. Обязательно.
                type: plantuml  
                # Путь к шаблону. Обязательно.
                template: templates/tree.puml   
                # Источник данных для рендера шаблона. Возвращает дерево объектов "interactions". Обязательно.
                source: >       
                  (
                      ... JSONata запрос или источник данных ...
                  )  
            blank:              
                type: plantuml  
                template: templates/blank.puml
                source: >
                    (
                        ... JSONata запрос или источник данных ...
                    )
        # JSON Schema контролирующая описание объекта сущности
        schema:                  
            type: object
            patternProperties:
                "[a-zA-Z0-9_]*(\\.[a-zA-Z0-9_]*)*$": # Шаблон ключа
                    type: array
                    minItems: 1
                    items:
                    ...
```

После создания манифеста сущности, можно приступать к описанию манифестов ее объектов.

```yaml
# Использование сущности расширенной метамодели
interactions:
  dochub:
    title: DocHub 
  dochub.user:
    title: Взаимодействия с пользователем
    triggers:
      - Просмотр архитектуры
    steps:
      - from: User
        to: DocHub
        value: Вход на портал
      - from: DocHub
        to: User
        value: Представление архитектурных артефактов
    results:
      - Информация о существующей архитектуре
  dochub.user.check:
    title: Прверка отклонений выявленных валидаторами
    triggers:
      - Просмотр архитектуры
    steps:
      - from: User
        to: DocHub
        value: Выбор раздела Проблемы
      - from: DocHub
        to: User
        value: Генерация дерева со статусами
      - from: User
        to: DocHub
        value: Выбор отклонения
      - from: DocHub
        to: User
        value: Карточка отклонения
    results:
      - Информация об отклонениях
  dochub.user.research:
    title: Изучение документации
    triggers:
      - Просмотр документов
    steps:
      - from: User
        to: DocHub
        value: Выбор раздела Документы
      - from: DocHub
        to: User
        value: Представление
    results:
      - Актуальная информация из документов    
```

Пример встраивания сущности в документ:
```markdown
![](@entity/interactions/blank?id=dochub.user)
```
Результат:
![](@entity/interactions/blank?id=dochub.user)

Воспользуйтесь правой кнопкой мышки, чтобы вызвать контекстное меню представления и переключить его.

Пример представления сущности в меню [здесь](/entities/interactions/blank?id=dochub.user).

[Далее](/docs/dochub.radar)
