entities: # Сущности расширенной матемодели
    # Взаимводействия
    interactions:               # Секция, где будет описываться объекты сущности "взаимодействие". Обязательно.
        title: Взаимодействия   # Название сущности. Обязательно.
        description: >          # Описание сущности текст или ссылка на документ. Необязательно.
            Взаимодействия между компонентами
        menu: >                 # Генератор раcположения в меню. Запрос или явное описание объета. Необязательно.
          (
            $interactions := $.interactions;
            $makeLocation := function($id) {(
            $arrleft := function($arr ,$count) {
                $map($arr, function($v, $i) {
                  $i <= $count ? $v
                })
              };
              $domains := $split($id, ".");
              $join($map($domains, function($domain, $index) {(
                $lookup($interactions, $join($arrleft($domains, $index), ".")).title
              )}), "/");
            )};
            $append([{
                "icon": *.icon,                                               /* Получаем иконку */
                "link": "/entities/interactions/general",                     /* Ссылка на форму представления general (дерево взаимодействий) */
                "location": "Взаимодействия"                                  /* Расположение в меню */
            }],
                [$.interactions.$spread().{
                    "icon": *.icon,                                           /* Получаем иконку */
                    "link": "/entities/interactions/blank?id=" & $keys()[0],  /* Формируем ссылку на бланк документ */
                    "location": $makeLocation($keys()[0])                     /* Формируем расположение в меню */
                }][location]
            );
          )
        presentations:          # Представления объектов сущности. Обязательно.
            blank:              # Основное представление. JSONata запрос или объект. Обязательно.
                type: plantuml  # Тип представления. По умолчанию "raw".
                template: templates/blank.puml
                source: >       # Источник данных для рендера шаблона. $ - объект
                    (
                        $
                    )
        shema:                  # JSON Schema контролирующая описание объекта сущности
            type: object
            patternProperties:
                "[a-zA-Z0-9_]*(\\.[a-zA-Z0-9_]*)*$": # Шаблон ключа
                    type: array
                    minItems: 1
                    items:
                        type: object
                        properties:
                            icon:
                                title: Иконка
                                type: string
                                minLength: 2
                            title:
                                title: Наименование
                                type: string
                                minLength: 5
                            triggers:
                                title: События запускающие взаимодействие
                                type: array
                                minItems: 1
                                items:
                                    type: string
                                    minLength: 5
                            steps:
                                title: Описание взаимодействия
                                type: array
                                minItems: 1
                                items:
                                    type: object
                                    properties:
                                        from:
                                            title: От кого
                                            type: string
                                            minLength: 1
                                        to:
                                            title: Кому
                                            type: string
                                            minLength: 1
                                        value:
                                            title: Что
                                            type: string
                                            minLength: 1
                                    required:
                                        - from
                                        - to
                                        - value
                            results:
                                title: Результаты взаимодействия
                                type: array
                                minItems: 1
                                items:
                                    type: string
                                    minLength: 5
                        required:
                            - title
                            - triggers
                            - results
                            - steps
# Использование сущности расширенной метамодели
interactions:
  dochub:
    title: DocHub 
  dochub.user:
    title: Взаимодействия с пользователем
    triggers:
      - Просмотр архитектуры
    steps:
      - from: User
        to: DocHub
        value: Представление
    results:
      - Информация о существующей архитектуре