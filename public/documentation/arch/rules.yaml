rules:
  validators:
    dochub.experts:                               # Валидатор контролирует заполнение поля expert для всех компонентов
      title: Не указаны эксперты для компонентов  # Название валидатора
      source: >                                   # Источник данных об ошибках. В данном случае JSONata запрос
        ([
          components.$spread().(                                /* Сканируем все компоненты */
              $ID := $keys()[0];                                /* Получаем идентификатор компонента */
              {                                                 /* Генерируем структуру описания ошибки */
                  "uid": "expert-component-" & $ID,             /* Уникальный идентификатор выявленной ошибки */
                  "location": "/architect/components/" & $ID,             /* Ссылка на расположение объекта ошибки */
                  "correction": "Укажите эксперта компонента",  /* Рекомендации как исправить проблему */
                  "description": "Компоненты должены иметь сведения об эксперте. 
                      Если необходимо исключить для данного компонента эту информацию,
                      укажите идентификатор ошибки в разделе 'exceptions' с описанием причины
                  ",
                  "standard": "/docs/dochub.standards.examples.expert" /* Ссылка на стандарт */
              }
          )[$not($boolean("" & *.expert))]        /* Отбираем все компоненты где поле 'expert' пустое*/
        ])
    dochub.experts.test:                              # Валидатор контролирует заполнение поля expert для всех компонентов
      title: Пробный анализ                           # Название валидатора
      source: >                                       # Источник данных об ошибках. В данном случае JSONata запрос
        ([
          components.$spread().(                                /* Сканируем все компоненты */
              $ID := $keys()[0];                                /* Получаем идентификатор компонента */
              {                                                 /* Генерируем структуру описания ошибки */
                  "uid": "expert2-component-" & $ID,             /* Уникальный идентификатор выявленной ошибки */
                  "location": "/architect/components/" & $ID,             /* Ссылка на расположение объекта ошибки */
                  "correction": "Укажите эксперта компонента",  /* Рекомендации как исправить проблему */
                  "description": "Компоненты должены иметь сведения об эксперте. 
                      Если необходимо исключить для данного компонента эту информацию,
                      укажите идентификатор ошибки в разделе 'exceptions' с описанием причины
                  ",
                  "standard": "/docs/dochub.standards.examples.expert" /* Ссылка на стандарт */
              }
          )[$not($boolean("" & *.expert))]        /* Отбираем все компоненты где поле 'expert' пустое*/
        ])
  exceptions:                                               # Исключения для валидаторов
    "expert-component-dochub.front":                        # UID ошибки для исключения
      reason: >                                             # Причина исключения
        Это пример исключения на обязательное заполнение
        поля "expert" для компонента "dochub.front"
      cause: /docs/dochub.exceptions.examples.dochub_front   # Документ-основание исключения