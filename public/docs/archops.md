# Введение
DocHub - инструмент управления архитектурой автоматизированных систем.

Описание архитектуры осуществляется через манифесты. Манифест - структурированный файл,
в котором описываются архитектурные компоненты и связи между ними.

Поддерживаются два формата файлов: JSON и YAML. Предпочтительным является формат YAML. 
Этот формат поддерживает комментарии, что существенно упрощает описание архитектуры.

Пример законченного манифеста можно посмотреть  [тут](/manifest/dochub.yaml). Он описывает 
архитектуру DocHub. Манифест состоит из разделов:
* **import**       - Позволяет подключать дополнительные манифесты.
* **namespaces**   - Определяет пространства имен. Все архитектурные объекты должны иметь уникальные
                     идентификаторы. Пространство имен позволяет избежать конфликта идентификаторов в случае
                     описания нескольких подсистем имеющих схожие архитектурные черты.
* **aspects**      - Архитектурные аспекты. Позволяют выделить и отобразить на схеме компоненты 
                     реализующие бизнес-функцию. Аспекты визуализируются на схемах внутри компонентов. 
* **contexts**     - Контексты представления архитектурных компонентов. Позволяет выделить группу 
                     компонентов и отобразить ее по смыслу заложенному в контекст. Например, выделить
                     все компоненты инфраструктуры. Через контексты реализуется смысл C4 Model.
* **docs**         - Документы необходимые для детального описания архитектуры. Например, контракты в
                     формате OpenAPI, PlantUML диаграммы, markdown документация.
* **technologies** - Технологический стек. Позволяет строить технологический радар. 
* **components**   - Архитектурные компоненты.

<br>Рассмотрим каждый из них отдельно:<br><br> 
 
# Импорт манифестов (imports)
Существует возможность описать всю архитектуру в одном манифесте. Но работа с единым файлом имеет 
ряд недостатков:
1. В объемном файле сложно контролировать вносимые изменения;
2. Устранение конфликтов усложняется, т.к. над одним файлом могут работать срезу несколько человек;
3. Обозримость описания архитектуры значительно ухудшается.

<br>Рекомендуется использовать структуру файлов и папок для устранения этих недостатков. Например, 
в отдельном файле развивать каждую секцию. Это позволяет сделать секция "import". 
Файловая структура может быть такой:
```text
./components/component1.yaml        - архитектурный компонент 1
./components/component2.yaml        - архитектурный компонент 2
./components/../../componentN.yaml  - архитектурный компонент N
./docs/doc1.yaml                    - документ 1
./docs/doc2.yaml                    - документ 2
./docs/../docN.yaml                 - документ N
./aspects.yaml                      - архитектурные аспекты
./contexts.yaml                     - контексты представления архитектуры
./components.yaml                   - архитектурные компоненты
./docs.yaml                         - документы
./technologies.yaml                 - технологический стек
./root.yaml                         - корневой манифест, содержащий только секцию "import"
./namespaces.yaml                   - пространства имен
```

В этом случае корневой манифест (root.yaml) будет выглядеть так: 

```yaml
imports:
  - aspects.yaml
  - contexts.yaml
  - components.yaml
  - docs.yaml
  - technologies.yaml
  - namespaces.yaml
```

Тогда, для примера, манифест компонентов (components.yaml) может быть таким:
```yaml
components:
  namespace.component1: components/component1.yaml
  namespace.component2: components/component2.yaml
  ...
  namespace.component3:
    title: Services
    entity: component
    technologies:
      - Go
    presentations:
      - contexts:
          - namespace.general
  ...
```
Следует отметить, что DocHub позволяет указывать описание объектов ссылками. В данном примере
для _namespace\.component1_ и _namespace\.component2_ указана ссылка (относительная) на файл описания. 
Компонент _namespace\.component3_ описан непосредственно в файле манифеста. 

Подключение дополнительных манифестов возможно из сторонних репозиториев **того же** инстанса GitLab,
а также с web-ресурсов по http/https протоколу. 

# Области имен (namespaces)

При описании нескольких автоматизированных систем, со схожими архитектурными чертами, может возникнуть
конфликт идентификаторов архитектурных объектов. Для решения этой проблемы в DocHub введены 
пространства имен - namespaces. В структуре идентификатора идентификатор пространства является 
префиксом отделенным от идентификатора объекта символом ".".

Пример:
```text
dochub.front
```

Здесь объект с идентификатором _front_ принадлежит пространству имен _dochub_.

При построении диаграмм, компоненты группируются в области на основании пространства имен. Например:

<dochub-object type="context" subject="dochub.main">
    [ТУТ ДОЛЖНА БЫТь СХЕМА]
</dochub-object>

На схеме отражены компоненты принадлежащие двум пространствам имен: DocHub и GitLab.

Если идентификатор принадлежит неописанной области имен, DocHub будет сообщать 
о наличии проблемы "Область имен отсутствует". Описание области имен производится в секции
"namespaces":

```yaml
namespaces:
    - dochub: # Идентификатор области имен
        title: DocHub # Название области имен. Будет отражаться на схемах
    - gitlab:
        title: GitLab
```

В данном примере описаны две области пространства имен: dochub и gitlab. 

# Контексты представлений (contexts)

Компоненты архитектуры имеют актуальность для контекста представления (визуализации на схеме). 
Контексты реализуют идею [C4 Model](https://ru.wikipedia.org/wiki/%D0%9C%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C_C4)
но не ограничивают количеством уровней представления. Например, DocHub описан в C4 Model через 4 контекста:

1. Уровень I: Система в масштабе ее взаимодействия с пользователями и другими системами

<dochub-object type="context" subject="dochub.c4level1">
    [ТУТ ДОЛЖНА БЫТь СХЕМА]
</dochub-object>

2. Уровень II: Взаимосвязанные контейнеры

<dochub-object type="context" subject="dochub.c4level2">
    [ТУТ ДОЛЖНА БЫТь СХЕМА]
</dochub-object>

3. Уровень III: Взаимосвязанные компоненты

<dochub-object type="context" subject="dochub.c4level3">
    [ТУТ ДОЛЖНА БЫТь СХЕМА]
</dochub-object>

Наглядно видно, что визуализация третьего уровня перегружена. В действительности, 
перегруженность может возникнуть на каждом уровне. Все зависит от масштаба архитектуры 
и детальности ее описания. 

Контексты решают эту проблему, т.к. не ограничиваются концепцией C4 Model. Они позволяют 
выделить секции архитектурных объектов на каждом уровне и рассмотреть их отдельно.

3. 1 Консолидация манифестов:

<dochub-object type="context" subject="dochub.manifest_build">
    [ТУТ ДОЛЖНА БЫТь СХЕМА]
</dochub-object>

4. Уровень IV: дополнительные сведения о дизайне архитектурных элементов 

<dochub-object type="document" subject="dochub_sequence">
    [ТУТ ДОЛЖНА БЫТь СХЕМА]
</dochub-object>

# Архитектурные аспекты (aspects)

# Документы (docs)

# Компоненты (components)
Компоненты являются базовыми сущностями манифестов. Манифест компонента описывает
его свойства: контексты представления, взаимосвязи с другими компонентами и т.д.

Пример описания компонента в манифесте:
```yaml
title: 3. Web app servers # Название компонента
entity: collections # Представление компонента на схеме (https://plantuml.com/ru/deployment-diagram)
technologies:   # Использованные технологии в компоненте
  - PHP
  - Symfony
presentations:  # Представления компонента
  - contexts:   # В каких контекстах компонент представлен
      - company.general
      - company.application
    links:   # Зависимости компонента от других компонентов
      - id: company.services # Идентификатор компонента
      - id: company.full_text_searcher
      - id: company.cache_service
      - id: company.database
      - id: company.queue
      - id: amazon.data_firehouse
      - id: company.load_balancer
        contract: publicapi # Зависимости может содержать информацию о контракте
aspects: # Какие аспекты компонент реализует
  - company.auth # Идентификатор аспекта
```

# Контексты
Представление архитектуры имеет смысл в определенном контексте. Например, 
в контексте уровня корпоративной архитектуры не имеет смысла отображать 
на схеме БД. В то же время, в контексте архитектуры данных нет смысла 
отображать компоненты управления трафиком.

Таким образом, при описании компонентов архитектуры указывается контекст
его представления.

```javascript
"components": {
    ...
    "pao_kit@auth": {
        ...
        "contexts" : ["global", "shop", "shop/c2c"]
        ...
    }
}

```

Контексты могут иметь иерархию. В данном примере контекст "с2с"
подчинен контексту "shop". Таким образом явно указывается, что 
контекст "с2с" является частью контекста "shop". 

Развернутое описание контекстов производится в секции манифеста 
"contexts".

```javascript
    "contexts": {
        ...
        "global": {
            "title": "ООО Кит"
        },
        "shop/c2c": {
            "title": "Услуги физлицам"
        }
        ...
    }
```

Развернутое описание является необязательным. В данном примере контексту 
"global" определен заголовок "ООО КИТ". Контексту "shop/c2c" определен 
заголовок "Услуги физлицам".

На основании иерархии контекстов строится меню навигации "Архитектура/Контексты".

# Ссылки
