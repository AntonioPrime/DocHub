$defs:
  # Схема для валидации самой JSONSchema
  $jsonschema:
    title: JSONSchema
    definitions:
      schemaArray:
        type: array
        minItems: 1
        items:
          "$ref": "#/$defs/$jsonschema"
      nonNegativeInteger:
        type: integer
        minimum: 0
      nonNegativeIntegerDefault0:
        allOf:
        - "$ref": "#/$defs/$jsonschema/definitions/nonNegativeInteger"
        - default: 0
      simpleTypes:
        enum:
        - array
        - boolean
        - integer
        - 'null'
        - number
        - object
        - string
      stringArray:
        type: array
        items:
          type: string
        uniqueItems: true
        default: []
    type:
    - object
    properties:
      "$id":
        type: string
        format: uri-reference
      "$schema":
        type: string
        format: uri
      "$ref":
        type: string
        format: uri-reference
      "$comment":
        type: string
      title:
        type: string
      description:
        type: string
      default: true
      readOnly:
        type: boolean
        default: false
      examples:
        type: array
        items: true
      multipleOf:
        type: number
        exclusiveMinimum: 0
      maximum:
        type: number
      exclusiveMaximum:
        type: number
      minimum:
        type: number
      exclusiveMinimum:
        type: number
      maxLength:
        "$ref": "#/$defs/$jsonschema/definitions/nonNegativeInteger"
      minLength:
        "$ref": "#/$defs/$jsonschema/definitions/nonNegativeIntegerDefault0"
      pattern:
        type: string
        format: regex
      additionalItems:
        "$ref": "#/$defs/$jsonschema"
      items:
        anyOf:
        - "$ref": "#/$defs/$jsonschema"
        - "$ref": "#/$defs/$jsonschema/definitions/schemaArray"
        default: true
      maxItems:
        "$ref": "#/$defs/$jsonschema/definitions/nonNegativeInteger"
      minItems:
        "$ref": "#/$defs/$jsonschema/definitions/nonNegativeIntegerDefault0"
      uniqueItems:
        type: boolean
        default: false
      contains:
        "$ref": "#/$defs/$jsonschema"
      maxProperties:
        "$ref": "#/$defs/$jsonschema/definitions/nonNegativeInteger"
      minProperties:
        "$ref": "#/$defs/$jsonschema/definitions/nonNegativeIntegerDefault0"
      required:
        "$ref": "#/$defs/$jsonschema/definitions/stringArray"
      additionalProperties:
        "$ref": "#/$defs/$jsonschema"
      definitions:
        type: object
        additionalProperties:
          "$ref": "#/$defs/$jsonschema"
        default: {}
      properties:
        type: object
        additionalProperties:
          "$ref": "#/$defs/$jsonschema"
        default: {}
      patternProperties:
        type: object
        additionalProperties:
          "$ref": "#/$defs/$jsonschema"
        propertyNames:
          format: regex
        default: {}
      dependencies:
        type: object
        additionalProperties:
          anyOf:
          - "$ref": "#/$defs/$jsonschema"
          - "$ref": "#/$defs/$jsonschema/definitions/stringArray"
      propertyNames:
        "$ref": "#/$defs/$jsonschema"
      const: true
      enum:
        type: array
        items: true
        minItems: 1
        uniqueItems: true
      type:
        anyOf:
        - "$ref": "#/$defs/$jsonschema/definitions/simpleTypes"
        - type: array
          items:
            "$ref": "#/$defs/$jsonschema/definitions/simpleTypes"
          minItems: 1
          uniqueItems: true
      format:
        type: string
      contentMediaType:
        type: string
      contentEncoding:
        type: string
      if:
        "$ref": "#/$defs/$jsonschema"
      then:
        "$ref": "#/$defs/$jsonschema"
      else:
        "$ref": "#/$defs/$jsonschema"
      allOf:
        "$ref": "#/$defs/$jsonschema/definitions/schemaArray"
      anyOf:
        "$ref": "#/$defs/$jsonschema/definitions/schemaArray"
      oneOf:
        "$ref": "#/$defs/$jsonschema/definitions/schemaArray"
      not:
        "$ref": "#/$defs/$jsonschema"
    default: true
  $jsonata:
    title: JSONata запрос
    type: string
    pattern: (\s+|)\(((.*|\d|\D)+?)(\)(\s+|))$
  $menu-item:
    title: Элемент меню
    type: object
    properties:
      title:
        title: Название
        type: string
      location: 
        title: Размещение
        type: string
      icon: 
        title: Иконка
        type: string
      link:
        title: Ссылка
        type: string
    required:
      - title
      - location
  $menu:
    title: Меню
    type: array
    items:
      $ref: "#/$defs/$menu-item"
    minLength: 1
  $doc-types:
    type: string
    enum: 
      - markdown
      - plantuml
      - smartants
  $file-name:
    type: string
  $data-source:
    anyOf:
      - "#/$defs/$jsonata"
      - "#/$defs/file-name"
      - type:
          - object
          - string
          - boolean
          - array
# Схема базовых сущностей
$entities:
  entities:
    type: object
    patternProperties:
      "^[0-9a-zA-Z][a-zA-Z0-9_-]*(\\.[a-zA-Z][a-zA-Z0-9_-]*)*$":
        type: object
        properties:
          title:
            title: Название сущности
            type: string
          description: 
            title: Описание сущности
            type: string
          schema:
            $ref: "#/$defs/$jsonschema"
          menu:
            anyOf:
              - $ref: "#/$defs/$jsonata"
              - $ref: "#/$defs/$menu"
          presentations:
            type: object
            patternProperties:
              "^[0-9a-zA-Z][a-zA-Z0-9_-]*(\\.[a-zA-Z][a-zA-Z0-9_-]*)*$":
                type: object
                properties:
                  title:
                    title: Название
                    type: string
                  params:
                    title: Схема параметров
                    $ref: "#/$defs/$jsonschema"
                  type:
                    title: Тип документа
                    $ref: "#/$defs/$doc-types"
                  $constructor:
                    title: Конструктор презентации
                    $ref: "#/$defs/$jsonata"
                  template:
                    title: Шаблон документа
                    $ref: "#/$defs/$file-name"
                  source:
                    title: Источник данных
                    $ref: "#/$defs/$data-source"







